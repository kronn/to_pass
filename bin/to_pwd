#!/usr/bin/env ruby
# -*- coding: utf-8 -*-
# vim:ft=ruby:enc=utf-8

base_path = ( File.expand_path(File.dirname(__FILE__)+'/..') )
$LOAD_PATH << base_path unless $LOAD_PATH.include?(base_path)

require 'optparse'
require 'lib/to_pwd'

# Pluggable Algorithms
Dir["#{base_path}/vendor/*.rb"].each do |file|
  require file
end

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: #{__FILE__} [options] passphrase"
  opts.separator ""

  opts.on('-a', '--algorithm ALGORITM', "use algorithm for transformation") do |value|
    options[:algorithm] = value ||Â 'PasswordString'
  end

  options[:pipe_usage] = ARGV[0].nil?

  opts.separator ""

  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end
end.parse!

# parse arguments
string, algorithm = [ ( ARGV[0] || $stdin.read ), Kernel.const_get(options[:algorithm]) ]

# perform "heavy" work
password = algorithm.new( string )

$stdout << password
$stdput << "\n" unless options[:pipe_usage]
